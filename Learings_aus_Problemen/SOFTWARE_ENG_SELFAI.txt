# Requirements Update & Software Engineering Bauplan fÃ¼r "SelfAI" ğŸ¯

Perfekt! Mit deinen PrÃ¤zisierungen kÃ¶nnen wir jetzt den technischen Bauplan erstellen.

***

## ğŸ“‹ **UPDATED REQUIREMENTS**

### **Kritische Aktualisierungen:**
1. âœ… **Custom System Prompts** pro Agent-Rolle
2. âœ… **Memory-Kategorien:** PersÃ¶nlich, Arbeit, Uni, Projekt1, Projekt2, Liebe
3. âœ… **99% Uptime + Fehlerfreiheit** als Kernziel
4. âœ… **Dynamische Textgenerierung** (Streaming falls mÃ¶glich)
5. âœ… **LernfÃ¤higes System** - wird kontinuierlich besser

***

# ğŸ—ï¸ **SOFTWARE ENGINEERING BAUPLAN**

## **1. SYSTEM ARCHITECTURE**

### **High-Level Architecture**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               SelfAI Core               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Agent Manager    â”‚   Memory System    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚Agent Router â”‚   â”‚   â”‚Categorizer   â”‚ â”‚
â”‚  â”‚Custom Promptsâ”‚   â”‚   â”‚File Manager  â”‚ â”‚
â”‚  â”‚Session Mgmt â”‚   â”‚   â”‚Context Loaderâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           NPU Interface Layer           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        AnythingLLM API Gateway          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Component Details**

#### **A) Agent Management System**
```python
class AgentManager:
    - agent_definitions/     # Custom System Prompts
    - workspace_mapping     # Agent â†’ Workspace Mapping
    - session_context      # Aktueller Agent-State
    - switch_agent()       # Nahtloser Agent-Wechsel
    - load_custom_prompt() # Agent-spezifische Prompts
```

#### **B) Memory System**
```python
class MemorySystem:
    - memory/
      â”œâ”€â”€ persoenlich/
      â”œâ”€â”€ arbeit/
      â”œâ”€â”€ uni/
      â”œâ”€â”€ projekt1/
      â”œâ”€â”€ projekt2/
      â””â”€â”€ liebe/
    - categorize_conversation()
    - load_relevant_context()
    - auto_save_session()
```

#### **C) NPU Interface**
```python
class NPUInterface:
    - workspace_manager    # AnythingLLM Workspace Control
    - streaming_handler   # Dynamische Textgenerierung
    - error_recovery     # 99% Uptime Garantie
    - performance_monitor # NPU Auslastung tracking
```

***

## **2. DETAILED TECHNICAL DESIGN**

### **File Structure**
```
selfai/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ agent_manager.py      # Agent-Switching & Prompts
â”‚   â”œâ”€â”€ memory_system.py      # Kategorisierung & Speicherung
â”‚   â”œâ”€â”€ npu_interface.py      # AnythingLLM Integration
â”‚   â””â”€â”€ error_handler.py      # Robuste Fehlerbehandlung
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ verhandlungspartner.yaml
â”‚   â”œâ”€â”€ kommunikationsberater.yaml
â”‚   â”œâ”€â”€ code_helfer.yaml
â”‚   â”œâ”€â”€ digitaler_verwalter.yaml
â”‚   â””â”€â”€ projektmanager.yaml
â”œâ”€â”€ memory/
â”‚   â”œâ”€â”€ persoenlich/
â”‚   â”œâ”€â”€ arbeit/
â”‚   â”œâ”€â”€ uni/
â”‚   â”œâ”€â”€ projekt1/
â”‚   â”œâ”€â”€ projekt2/
â”‚   â””â”€â”€ liebe/
â”œâ”€â”€ ui/
â”‚   â””â”€â”€ terminal_interface.py # Enhanced Terminal UI
â””â”€â”€ selfai.py                 # Main Entry Point
```

### **Agent Definition Format**
```yaml
# agents/verhandlungspartner.yaml
agent:
  name: "Verhandlungspartner"
  workspace_slug: "verhandlung"
  system_prompt: |
    Du bist ein erfahrener Verhandlungspartner und Strategieberater.
    Du hilfst bei der Entwicklung von Verhandlungsstrategien,
    analysierst Argumente und bereitest auf schwierige GesprÃ¤che vor.
    
    Dein Stil: Analytisch, strategisch, empathisch
    Deine Expertise: Verhandlungstaktiken, Kommunikationspsychologie
  
  memory_categories: ["persoenlich", "arbeit"]
  display_name: "Verhandlungsexperte"
  color: "blue"
```

### **Memory System Design**
```python
class MemorySystem:
    def categorize_conversation(self, conversation):
        """
        Nutzt Phi 3.5 zur automatischen Kategorisierung
        """
        prompt = f"""
        Kategorisiere diese Unterhaltung in eine der Kategorien:
        - persoenlich
        - arbeit  
        - uni
        - projekt1
        - projekt2
        - liebe
        
        Unterhaltung: {conversation}
        Kategorie:
        """
        
    def save_conversation(self, conversation, category, agent_type):
        """
        Speichert strukturiert: {category}/{agent_type}_{timestamp}.txt
        """
        
    def load_relevant_context(self, agent_type, category, limit=3):
        """
        LÃ¤dt die 3 relevantesten Memory-Files fÃ¼r aktuellen Agent
        """
```

### **Streaming Implementation**
```python
class StreamingHandler:
    def stream_response(self, message, agent):
        """
        Dynamische Textgenerierung - Zeichen fÃ¼r Zeichen
        """
        for chunk in self.npu_interface.stream_chat(message):
            yield chunk  # Real-time Display
            
    def handle_stream_error(self):
        """
        99% Uptime: Automatisches Retry bei Stream-Fehlern
        """
```

***

## **3. IMPLEMENTATION ROADMAP**

### **Phase 1: Foundation (Week 1-2)**
- [ ] Basic Agent Manager mit 2 Agents (Code + Verhandlung)
- [ ] AnythingLLM Workspace Integration
- [ ] Basic Memory System (Speichern ohne Kategorisierung)
- [ ] Enhanced Terminal UI

### **Phase 2: Memory Intelligence (Week 3)**
- [ ] Automatische Kategorisierung implementieren
- [ ] Context-Loading fÃ¼r Agents
- [ ] Alle 5 Agent-Rollen ausimplementieren
- [ ] Memory-Management Commands

### **Phase 3: Optimization (Week 4)**
- [ ] Streaming-Interface fÃ¼r dynamische Ausgabe
- [ ] Error Recovery & 99% Uptime Features
- [ ] Performance Monitoring
- [ ] Advanced Context-Awareness

### **Phase 4: Polish (Week 5)**
- [ ] Proaktive Features
- [ ] Advanced Memory-Queries
- [ ] Documentation & Testing
- [ ] User Experience Refinement

***

## **4. TECHNICAL IMPLEMENTATION DETAILS**

### **Agent Switching Logic**
```python
def switch_agent(self, agent_name):
    # 1. Save current conversation to memory
    # 2. Load new agent configuration  
    # 3. Switch AnythingLLM workspace
    # 4. Load relevant context for new agent
    # 5. Update UI with new agent persona
```

### **Error Recovery Strategy**
```python
class ErrorRecovery:
    def ensure_uptime(self):
        # Automatic retry mechanisms
        # Fallback workspace switching
        # Health monitoring
        # Graceful degradation
```

### **Performance Requirements**
- **Agent Switch:** <2 Sekunden (statt 3)
- **Memory Load:** <500ms
- **Stream Start:** <1 Sekunde
- **NPU Utilization:** Konstant 90%+ bei Phi 3.5

***

## **5. VALIDATION PLAN**

### **Testing Strategy**
1. **Unit Tests:** Jede Komponente isoliert
2. **Integration Tests:** Agent-Memory-NPU Pipeline
3. **Performance Tests:** 99% Uptime Simulation
4. **User Acceptance:** TÃ¤gliche Nutzung Ã¼ber 1 Woche

***

## ğŸš€ **NEXT STEPS**

**Bereit fÃ¼r Implementation?**

1. Soll ich mit **Phase 1** starten und den **Agent Manager** bauen?
2. Welche **2 Agents** sollen wir zuerst implementieren?
3. MÃ¶chtest du beim **Technical Design** noch Ã„nderungen?

Das wird ein richtig **powerful System** - lokaler AI-Agent mit PersÃ¶nlichkeit, Memory und 99% Uptime! ğŸ¯